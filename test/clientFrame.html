<html>
<head>
<script src="../ChannelPlate.js"></script>
<script src="../iframe.js"></script>
<script>
// Google BSD license http://code.google.com/google_bsd_license.html
// Copyright 2013 Google Inc. johnjbarton@google.com

var DEBUG = false;
var TIME_LIMIT = 1000;

function tookTooLong() {
    output('FAIL: server did not respond within ' + TIME_LIMIT + ' millisecs.')
}

var timeoutId = setTimeout(tookTooLong, TIME_LIMIT);

function output(msg) {
    var div = document.createElement('div');
    div.textContent = msg;
    document.body.appendChild(div);
    console.log(msg);
}

var serverMethods = {
    add: function(lhs, rhs, resultsBack, errBack){},
    div: function(lhs, rhs, resultsBack, errBack){}
}

ChannelPlate.iframe.parent.startClient(serverMethods, function(proxy) {
    proxy.add(2,2, function(result){
        if (result === 4) {
            output('PASS: ' + result);
        } else {
            output('FAIL: ' + result)
        }
        proxy.div(2,0,
            function(result){
                output('FAIL: ' + result);
                clearTimeout(timeoutId);
            },
            function (err) {
                output('PASS: ' + err);
                clearTimeout(timeoutId);
            }
        );
    });
});
</script>
</head>
<body>
<p>Testing iframe remote methods</p>
</body>
</html>
